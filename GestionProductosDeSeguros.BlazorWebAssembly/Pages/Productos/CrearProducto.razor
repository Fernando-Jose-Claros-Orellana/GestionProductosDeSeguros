@page "/crear-producto"
@using GestionProductosDeSeguros.BlazorWebAssembly.DataService
@using GestionProductosDeSeguros.DTOs.ProductoDTOs
@using System.ComponentModel.DataAnnotations

@inject ProductoService ProductoService
@inject NavigationManager NavigationManager

<PageTitle>Crear Producto</PageTitle>

<h1>Crear Nuevo Producto</h1>

<EditForm Model="@nuevoProducto" OnValidSubmit="@GuardarProducto">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label for="nombre" class="form-label">Nombre</label>
        <InputText id="nombre" class="form-control" @bind-Value="nuevoProducto.Nombre" />
    </div>

    <div class="mb-3">
        <label for="descripcion" class="form-label">Descripción</label>
        <InputTextArea id="descripcion" class="form-control" @bind-Value="nuevoProducto.Descripcion" />
    </div>

    <div class="mb-3">
        <label for="tipoProductoId" class="form-label">Tipo de Producto</label>
        <InputSelect id="tipoProductoId" class="form-select" @bind-Value="nuevoProducto.TipoProductoNombre">
            <option value="">Seleccionar Tipo</option>
            <option value="Auto">Auto</option>
            <option value="Salud">Salud</option>
            <option value="Vida">Vida</option>
            <option value="Hogar">Accidentes Personales</option>
            <option value="Residencial">Residencial</option>
            <option value="Fianzas">Fianzas</option>
        </InputSelect>
    </div>

    <div class="mb-3">
        <label for="formaPagoId" class="form-label">Forma de Pago</label>
        <InputSelect id="formaPagoId" class="form-select" @bind-Value="nuevoProducto.FormaPagoNombre">
            <option value="">Seleccionar Forma de Pago</option>
            <option value="Mensual">Mensual</option>
            <option value="Trimestral">Trimestral</option>
            <option value="Semestral">Semestral</option>
            <option value="Anual">Anual</option>
        </InputSelect>
    </div>

    <div class="mb-3">
        <label for="primaAnual" class="form-label">Prima Anual</label>
        <InputNumber id="primaAnual" class="form-control" @bind-Value="nuevoProducto.PrimaAnual" />
    </div>

    <div class="mb-3">
        <label for="sumaAsegurada" class="form-label">Suma Asegurada</label>
        <InputNumber id="sumaAsegurada" class="form-control" @bind-Value="nuevoProducto.SumaAsegurada" />
    </div>

    <button type="submit" class="btn btn-primary">Guardar</button>
    <button class="btn btn-secondary" @onclick="Cancelar">Cancelar</button>
</EditForm>

@code {
    private CrearProductoDTO nuevoProducto = new CrearProductoDTO();

    private async Task GuardarProducto()
    {
        var resultado = await ProductoService.CrearProducto(nuevoProducto);
        if (resultado)
        {
            NavigationManager.NavigateTo("/lista-producto");
        }
        else
        {
            // Manejar el caso en que la creación falla (mostrar mensaje de error)
            await js.InvokeVoidAsync("alert", "No se pudo crear el producto.");
        }
    }

    private void Cancelar()
    {
        NavigationManager.NavigateTo("/lista-producto");
    }

    [Inject]
    private IJSRuntime js { get; set; }
}